name: Deploy to GitHub Pages

on:
  workflow_dispatch:

  workflow_run:
    workflows: ["CD.yml"]
    types:
      - completed

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      # Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Download artifacts from the CD workflow
      - name: Download artifacts
        uses: actions/download-artifact@v4
        with:
          path: ./artifacts # Destination folder for downloaded artifacts

      # Setup Git for deployment
      - name: Set up Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      # Add new or updated artifacts to the gh-pages branch
      - name: Deploy to GitHub Pages
        run: |
          git fetch --depth=1 origin gh-pages
          git checkout gh-pages
          cp -R ./artifacts/* ./ # Copy new artifacts
          git add .
          git commit -m "Deploy from CD workflow artifacts [skip ci]" || echo "No changes to commit"
          git push origin gh-pages